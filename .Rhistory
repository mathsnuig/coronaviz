county=="Kerry"|county=="Limerick"|
county=="Tipperary"|county=="Waterford" ~ "Munster",
county=="Galway"|county=="Leitrim"|
county=="Mayo"|county=="Roscommon"|
county=="Sligo" ~ "Connacht",
county=="Donegal"|county=="Cavan"|
county=="Monaghan" ~ "Ulster (ROI)"))
library(nlme)
dat <- dat %>%
mutate(day = date-min(date)) %>%
group_by(county) %>%
mutate(ncases = 100000*c(NA,diff(ncases))/pop)%>%
select(day, county, ncases) %>%
na.omit()
ggplot(dat, aes(x=day,y=ncases,color=county)) + geom_smooth(se=FALSE)
(max(dat$day)-1)
dat <- read.csv("data/corona_county.csv") %>%
mutate(date = as.Date(date,format = "%d/%m/%Y"),
ncases = as.character(ncase),
ncases = ifelse(ncases == "< = 5","5",ncases),
ncases = as.numeric(ncases),
pop = case_when(county == "Carlow" ~ 24272,
county == "Cavan" ~ 76176,
county == "Clare" ~ 118817,
county == "Donegal" ~159192,
county == "Kildare" ~ 222504,
county == "Kilkenny" ~ 99232,
county == "Laois" ~ 84697,
county == "Leitrim" ~32044,
county == "Longford" ~ 40873,
county == "Louth" ~ 128884,
county == "Mayo" ~ 130507,
county == "Meath" ~ 195044,
county == "Monaghan" ~61386,
county == "Offaly" ~ 77961,
county == "Roscommon" ~ 64544,
county == "Sligo" ~ 65535,
county == "Tipperary" ~ 159553,
county == "Wexford" ~ 149722,
county == "Kerry" ~ 147707,
county == "Waterford" ~ 116176,
county == "Westmeath" ~ 88770,
county == "Wicklow" ~ 142425,
county == "Galway" ~ 258058,
county == "Limerick" ~ 194899,
county == "Cork" ~ 542868,
county == "Dublin" ~ 1347359),
long = case_when(county == "Carlow" ~ -6.9261098,
county == "Cavan" ~ -7.3605599,
county == "Clare" ~ -8.9811,
county == "Donegal" ~ -8.1041,
county == "Kildare" ~ -6.9144402,
county == "Kilkenny" ~ -7.2448,
county == "Laois" ~ -7.3323,
county == "Leitrim" ~ -8.0020,
county == "Longford" ~ -7.7933,
county == "Louth" ~ -6.4889,
county == "Mayo" ~ -9.4289,
county == "Meath" ~ -6.6564,
county == "Monaghan" ~ -6.9683,
county == "Offaly" ~ -7.7122,
county == "Roscommon" ~ -8.1891,
county == "Sligo" ~ -8.4761,
county == "Tipperary" ~ -8.1619,
county == "Wexford" ~ -6.4633,
county == "Kerry" ~ -9.5669,
county == "Waterford" ~ -7.1101,
county == "Westmeath" ~ -7.4653,
county == "Wicklow" ~ -6.0446,
county == "Galway" ~ -9.0568,
county == "Limerick" ~ -8.6267,
county == "Cork" ~ -8.4756,
county == "Dublin" ~ -6.2603),
lat = case_when(county == "Carlow" ~ 52.8408318,
county == "Cavan" ~ 53.9908295,
county == "Clare" ~ 52.9045,
county == "Donegal" ~ 54.6549,
county == "Kildare" ~ 53.1561089,
county == "Kilkenny" ~ 52.6541,
county == "Laois" ~ 52.9943,
county == "Leitrim" ~ 54.1247,
county == "Longford" ~ 53.7276,
county == "Louth" ~ 53.9252,
county == "Mayo" ~ 54.0153,
county == "Meath" ~ 53.6055,
county == "Monaghan" ~ 54.2492,
county == "Offaly" ~ 53.2357,
county == "Roscommon" ~ 53.6276,
county == "Sligo" ~ 54.2766,
county == "Tipperary" ~ 52.4738,
county == "Wexford" ~ 52.3369,
county == "Kerry" ~ 52.1545,
county == "Waterford" ~ 52.2593,
county == "Westmeath" ~ 53.5345,
county == "Wicklow" ~ 52.9808,
county == "Galway" ~ 53.2707,
county == "Limerick" ~ 52.6638,
county == "Cork" ~ 51.8985,
county == "Dublin" ~ 53.3498),
province = case_when(county=="Carlow"|county=="Dublin"|
county=="Kildare"|county=="Kilkenny"|
county=="Laois"|county=="Longford"|
county=="Louth"|county=="Meath"|
county=="Offaly"|county=="Westmeath"|
county=="Wexford"|county=="Wicklow" ~ "Leinster",
county=="Clare"|county=="Cork"|
county=="Kerry"|county=="Limerick"|
county=="Tipperary"|county=="Waterford" ~ "Munster",
county=="Galway"|county=="Leitrim"|
county=="Mayo"|county=="Roscommon"|
county=="Sligo" ~ "Connacht",
county=="Donegal"|county=="Cavan"|
county=="Monaghan" ~ "Ulster (ROI)"))
library(nlme)
dat <- dat %>%
mutate(day = as.numeric(date-min(date))) %>%
group_by(county) %>%
mutate(ncases = 100000*c(NA,diff(ncases))/pop)%>%
select(day, county, ncases) %>%
na.omit()
ggplot(dat, aes(x=day,y=ncases,color=county)) + geom_smooth(se=FALSE)
max(dat$day)
for(i in 1:(max(dat$day)-1)){
dat[[paste0("spline",i)]] <- ifelse(day > i, day-i, 0)
}
dat <- read.csv("data/corona_county.csv") %>%
mutate(date = as.Date(date,format = "%d/%m/%Y"),
ncases = as.character(ncase),
ncases = ifelse(ncases == "< = 5","5",ncases),
ncases = as.numeric(ncases),
pop = case_when(county == "Carlow" ~ 24272,
county == "Cavan" ~ 76176,
county == "Clare" ~ 118817,
county == "Donegal" ~159192,
county == "Kildare" ~ 222504,
county == "Kilkenny" ~ 99232,
county == "Laois" ~ 84697,
county == "Leitrim" ~32044,
county == "Longford" ~ 40873,
county == "Louth" ~ 128884,
county == "Mayo" ~ 130507,
county == "Meath" ~ 195044,
county == "Monaghan" ~61386,
county == "Offaly" ~ 77961,
county == "Roscommon" ~ 64544,
county == "Sligo" ~ 65535,
county == "Tipperary" ~ 159553,
county == "Wexford" ~ 149722,
county == "Kerry" ~ 147707,
county == "Waterford" ~ 116176,
county == "Westmeath" ~ 88770,
county == "Wicklow" ~ 142425,
county == "Galway" ~ 258058,
county == "Limerick" ~ 194899,
county == "Cork" ~ 542868,
county == "Dublin" ~ 1347359),
long = case_when(county == "Carlow" ~ -6.9261098,
county == "Cavan" ~ -7.3605599,
county == "Clare" ~ -8.9811,
county == "Donegal" ~ -8.1041,
county == "Kildare" ~ -6.9144402,
county == "Kilkenny" ~ -7.2448,
county == "Laois" ~ -7.3323,
county == "Leitrim" ~ -8.0020,
county == "Longford" ~ -7.7933,
county == "Louth" ~ -6.4889,
county == "Mayo" ~ -9.4289,
county == "Meath" ~ -6.6564,
county == "Monaghan" ~ -6.9683,
county == "Offaly" ~ -7.7122,
county == "Roscommon" ~ -8.1891,
county == "Sligo" ~ -8.4761,
county == "Tipperary" ~ -8.1619,
county == "Wexford" ~ -6.4633,
county == "Kerry" ~ -9.5669,
county == "Waterford" ~ -7.1101,
county == "Westmeath" ~ -7.4653,
county == "Wicklow" ~ -6.0446,
county == "Galway" ~ -9.0568,
county == "Limerick" ~ -8.6267,
county == "Cork" ~ -8.4756,
county == "Dublin" ~ -6.2603),
lat = case_when(county == "Carlow" ~ 52.8408318,
county == "Cavan" ~ 53.9908295,
county == "Clare" ~ 52.9045,
county == "Donegal" ~ 54.6549,
county == "Kildare" ~ 53.1561089,
county == "Kilkenny" ~ 52.6541,
county == "Laois" ~ 52.9943,
county == "Leitrim" ~ 54.1247,
county == "Longford" ~ 53.7276,
county == "Louth" ~ 53.9252,
county == "Mayo" ~ 54.0153,
county == "Meath" ~ 53.6055,
county == "Monaghan" ~ 54.2492,
county == "Offaly" ~ 53.2357,
county == "Roscommon" ~ 53.6276,
county == "Sligo" ~ 54.2766,
county == "Tipperary" ~ 52.4738,
county == "Wexford" ~ 52.3369,
county == "Kerry" ~ 52.1545,
county == "Waterford" ~ 52.2593,
county == "Westmeath" ~ 53.5345,
county == "Wicklow" ~ 52.9808,
county == "Galway" ~ 53.2707,
county == "Limerick" ~ 52.6638,
county == "Cork" ~ 51.8985,
county == "Dublin" ~ 53.3498),
province = case_when(county=="Carlow"|county=="Dublin"|
county=="Kildare"|county=="Kilkenny"|
county=="Laois"|county=="Longford"|
county=="Louth"|county=="Meath"|
county=="Offaly"|county=="Westmeath"|
county=="Wexford"|county=="Wicklow" ~ "Leinster",
county=="Clare"|county=="Cork"|
county=="Kerry"|county=="Limerick"|
county=="Tipperary"|county=="Waterford" ~ "Munster",
county=="Galway"|county=="Leitrim"|
county=="Mayo"|county=="Roscommon"|
county=="Sligo" ~ "Connacht",
county=="Donegal"|county=="Cavan"|
county=="Monaghan" ~ "Ulster (ROI)"))
library(nlme)
dat <- dat %>%
mutate(day = as.numeric(date-min(date))) %>%
group_by(county) %>%
mutate(ncases = 100000*c(NA,diff(ncases))/pop)%>%
select(day, county, ncases) %>%
na.omit()
View(dat)
for(i in 1:(max(dat$day)-1)){
dat[[paste0("spline",i)]] <- ifelse(dat$day > i, dat$day-i, 0)
}
View(dat)
?assign
?as.formula
for(i in 1:(max(dat$day)-1)){
dat[[paste0("spline",i)]] <- ifelse(dat$day > i, dat$day-i, 0)
assign(paste0("model",i), lme(as.formula(paste0("ncases ~ day + spline",i)), random = ~day|county, data = dat))
}
assign(paste0("model",1), lme(ncases ~ day + spline1, random = ~day|county, data = dat)
)
as.formula(paste0("ncases ~ day + spline",20))
assign(paste0("model",20), lme(as.formula(paste0("ncases ~ day + spline",20)), random = ~day|county, data = dat))
View(dat)
for(i in 5:60){
assign(paste0("model",i), lme(as.formula(paste0("ncases ~ day + spline",i)), random = ~day|county, data = dat))
}
anova(model5,model6)
anova(model5)
summary(model5)
summary(model5)$AIC
length(5:60)
AIC <- rep(NA, 56)
AIC[i-4] <- summary(lme(as.formula(paste0("ncases ~ day + spline",i)), random = ~day|county, data = dat))$AIC
AIC <- rep(NA, 56)
for(i in 5:60){
AIC[i-4] <- summary(lme(as.formula(paste0("ncases ~ day + spline",i)), random = ~day|county, data = dat))$AIC
}
AIC
plot(AIC)
min(AIC)
which(AIC,min(AIC))
# lowest at 29
model <- lme(ncases ~ day + spline29, random = ~day|county, data = dat)
summary(model)
dat <- read.csv("data/corona_county.csv") %>%
mutate(date = as.Date(date,format = "%d/%m/%Y"),
ncases = as.character(ncase),
ncases = ifelse(ncases == "< = 5","5",ncases),
ncases = as.numeric(ncases),
pop = case_when(county == "Carlow" ~ 24272,
county == "Cavan" ~ 76176,
county == "Clare" ~ 118817,
county == "Donegal" ~159192,
county == "Kildare" ~ 222504,
county == "Kilkenny" ~ 99232,
county == "Laois" ~ 84697,
county == "Leitrim" ~32044,
county == "Longford" ~ 40873,
county == "Louth" ~ 128884,
county == "Mayo" ~ 130507,
county == "Meath" ~ 195044,
county == "Monaghan" ~61386,
county == "Offaly" ~ 77961,
county == "Roscommon" ~ 64544,
county == "Sligo" ~ 65535,
county == "Tipperary" ~ 159553,
county == "Wexford" ~ 149722,
county == "Kerry" ~ 147707,
county == "Waterford" ~ 116176,
county == "Westmeath" ~ 88770,
county == "Wicklow" ~ 142425,
county == "Galway" ~ 258058,
county == "Limerick" ~ 194899,
county == "Cork" ~ 542868,
county == "Dublin" ~ 1347359),
long = case_when(county == "Carlow" ~ -6.9261098,
county == "Cavan" ~ -7.3605599,
county == "Clare" ~ -8.9811,
county == "Donegal" ~ -8.1041,
county == "Kildare" ~ -6.9144402,
county == "Kilkenny" ~ -7.2448,
county == "Laois" ~ -7.3323,
county == "Leitrim" ~ -8.0020,
county == "Longford" ~ -7.7933,
county == "Louth" ~ -6.4889,
county == "Mayo" ~ -9.4289,
county == "Meath" ~ -6.6564,
county == "Monaghan" ~ -6.9683,
county == "Offaly" ~ -7.7122,
county == "Roscommon" ~ -8.1891,
county == "Sligo" ~ -8.4761,
county == "Tipperary" ~ -8.1619,
county == "Wexford" ~ -6.4633,
county == "Kerry" ~ -9.5669,
county == "Waterford" ~ -7.1101,
county == "Westmeath" ~ -7.4653,
county == "Wicklow" ~ -6.0446,
county == "Galway" ~ -9.0568,
county == "Limerick" ~ -8.6267,
county == "Cork" ~ -8.4756,
county == "Dublin" ~ -6.2603),
lat = case_when(county == "Carlow" ~ 52.8408318,
county == "Cavan" ~ 53.9908295,
county == "Clare" ~ 52.9045,
county == "Donegal" ~ 54.6549,
county == "Kildare" ~ 53.1561089,
county == "Kilkenny" ~ 52.6541,
county == "Laois" ~ 52.9943,
county == "Leitrim" ~ 54.1247,
county == "Longford" ~ 53.7276,
county == "Louth" ~ 53.9252,
county == "Mayo" ~ 54.0153,
county == "Meath" ~ 53.6055,
county == "Monaghan" ~ 54.2492,
county == "Offaly" ~ 53.2357,
county == "Roscommon" ~ 53.6276,
county == "Sligo" ~ 54.2766,
county == "Tipperary" ~ 52.4738,
county == "Wexford" ~ 52.3369,
county == "Kerry" ~ 52.1545,
county == "Waterford" ~ 52.2593,
county == "Westmeath" ~ 53.5345,
county == "Wicklow" ~ 52.9808,
county == "Galway" ~ 53.2707,
county == "Limerick" ~ 52.6638,
county == "Cork" ~ 51.8985,
county == "Dublin" ~ 53.3498),
province = case_when(county=="Carlow"|county=="Dublin"|
county=="Kildare"|county=="Kilkenny"|
county=="Laois"|county=="Longford"|
county=="Louth"|county=="Meath"|
county=="Offaly"|county=="Westmeath"|
county=="Wexford"|county=="Wicklow" ~ "Leinster",
county=="Clare"|county=="Cork"|
county=="Kerry"|county=="Limerick"|
county=="Tipperary"|county=="Waterford" ~ "Munster",
county=="Galway"|county=="Leitrim"|
county=="Mayo"|county=="Roscommon"|
county=="Sligo" ~ "Connacht",
county=="Donegal"|county=="Cavan"|
county=="Monaghan" ~ "Ulster (ROI)"))
library(nlme)
dat <- dat %>%
mutate(day = as.numeric(date-min(date))) %>%
group_by(county) %>%
mutate(ncases = 100000*c(NA,diff(ncases))/pop)%>%
select(day, date, county, ncases) %>%
na.omit()
runApp('covid/coronaviz')
runApp('covid/coronaviz')
runApp('covid/coronaviz')
shiny::runApp('covid/coronaviz')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(leaflet)
library(DT)
rm(list=ls())
dat <- read.csv("data/corona_county.csv") %>%
mutate(date = as.Date(date,format = "%d/%m/%Y"),
ncases = as.character(ncase),
ncases = ifelse(ncases == "< = 5","5",ncases),
ncases = as.numeric(ncases),
pop = case_when(county == "Carlow" ~ 24272,
county == "Cavan" ~ 76176,
county == "Clare" ~ 118817,
county == "Donegal" ~159192,
county == "Kildare" ~ 222504,
county == "Kilkenny" ~ 99232,
county == "Laois" ~ 84697,
county == "Leitrim" ~32044,
county == "Longford" ~ 40873,
county == "Louth" ~ 128884,
county == "Mayo" ~ 130507,
county == "Meath" ~ 195044,
county == "Monaghan" ~61386,
county == "Offaly" ~ 77961,
county == "Roscommon" ~ 64544,
county == "Sligo" ~ 65535,
county == "Tipperary" ~ 159553,
county == "Wexford" ~ 149722,
county == "Kerry" ~ 147707,
county == "Waterford" ~ 116176,
county == "Westmeath" ~ 88770,
county == "Wicklow" ~ 142425,
county == "Galway" ~ 258058,
county == "Limerick" ~ 194899,
county == "Cork" ~ 542868,
county == "Dublin" ~ 1347359),
long = case_when(county == "Carlow" ~ -6.9261098,
county == "Cavan" ~ -7.3605599,
county == "Clare" ~ -8.9811,
county == "Donegal" ~ -8.1041,
county == "Kildare" ~ -6.9144402,
county == "Kilkenny" ~ -7.2448,
county == "Laois" ~ -7.3323,
county == "Leitrim" ~ -8.0020,
county == "Longford" ~ -7.7933,
county == "Louth" ~ -6.4889,
county == "Mayo" ~ -9.4289,
county == "Meath" ~ -6.6564,
county == "Monaghan" ~ -6.9683,
county == "Offaly" ~ -7.7122,
county == "Roscommon" ~ -8.1891,
county == "Sligo" ~ -8.4761,
county == "Tipperary" ~ -8.1619,
county == "Wexford" ~ -6.4633,
county == "Kerry" ~ -9.5669,
county == "Waterford" ~ -7.1101,
county == "Westmeath" ~ -7.4653,
county == "Wicklow" ~ -6.0446,
county == "Galway" ~ -9.0568,
county == "Limerick" ~ -8.6267,
county == "Cork" ~ -8.4756,
county == "Dublin" ~ -6.2603),
lat = case_when(county == "Carlow" ~ 52.8408318,
county == "Cavan" ~ 53.9908295,
county == "Clare" ~ 52.9045,
county == "Donegal" ~ 54.6549,
county == "Kildare" ~ 53.1561089,
county == "Kilkenny" ~ 52.6541,
county == "Laois" ~ 52.9943,
county == "Leitrim" ~ 54.1247,
county == "Longford" ~ 53.7276,
county == "Louth" ~ 53.9252,
county == "Mayo" ~ 54.0153,
county == "Meath" ~ 53.6055,
county == "Monaghan" ~ 54.2492,
county == "Offaly" ~ 53.2357,
county == "Roscommon" ~ 53.6276,
county == "Sligo" ~ 54.2766,
county == "Tipperary" ~ 52.4738,
county == "Wexford" ~ 52.3369,
county == "Kerry" ~ 52.1545,
county == "Waterford" ~ 52.2593,
county == "Westmeath" ~ 53.5345,
county == "Wicklow" ~ 52.9808,
county == "Galway" ~ 53.2707,
county == "Limerick" ~ 52.6638,
county == "Cork" ~ 51.8985,
county == "Dublin" ~ 53.3498),
province = case_when(county=="Carlow"|county=="Dublin"|
county=="Kildare"|county=="Kilkenny"|
county=="Laois"|county=="Longford"|
county=="Louth"|county=="Meath"|
county=="Offaly"|county=="Westmeath"|
county=="Wexford"|county=="Wicklow" ~ "Leinster",
county=="Clare"|county=="Cork"|
county=="Kerry"|county=="Limerick"|
county=="Tipperary"|county=="Waterford" ~ "Munster",
county=="Galway"|county=="Leitrim"|
county=="Mayo"|county=="Roscommon"|
county=="Sligo" ~ "Connacht",
county=="Donegal"|county=="Cavan"|
county=="Monaghan" ~ "Ulster (ROI)"))
library(scales)
library(lubridate)
dat %>% mutate(date = as.Date(date,format = "%d/%m/%Y")) %>%
group_by(county) %>%
mutate(New_cases = 100000*c(NA,diff(ncases))/pop)%>%
filter(county != "Dublin") %>%
ggplot(aes(x=date,y=New_cases,color=county,group=county)) +
geom_smooth(se=FALSE) + theme_bw() + labs(y="Actual new cases (not scaled)")+
theme(axis.text.x = element_text(angle=45, hjust = 1)) +
scale_y_continuous(limit=c(0,NA),oob=squish) +
scale_x_date(date_breaks = "3 days")
dat %>% mutate(date = as.Date(date,format = "%d/%m/%Y")) %>%
group_by(county) %>%
mutate(New_cases = c(NA,diff(ncases)),
week = week(date)) %>%
group_by(week, county) %>%
summarise(average = mean(New_cases, na.rm = TRUE))
runApp('covid/coronaviz/mobileapp.R')
library(survey)
?rake
shiny::runApp('covid/coronaviz')
runApp('covid/coronaviz')
shiny::runApp('covid/coronaviz')
runApp('covid/coronaviz')
runApp('covid/coronaviz')
shiny::runApp('covid/coronaviz')
runApp('covid/coronaviz/mobileapp.R')
mean()
mean
shiny::runApp('covid/coronaviz')
runApp('covid/coronaviz')
386572-367780
18792/7
runApp('covid/coronaviz')
runApp('covid/coronaviz/mobileapp.R')
runApp('covid/coronaviz/mobileapp.R')
